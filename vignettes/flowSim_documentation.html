<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Sebastiano Montante" />

<meta name="date" content="2023-02-09" />

<title>flowSim introduction</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">flowSim introduction</h1>
<h4 class="author"><em>Sebastiano Montante</em></h4>
<h4 class="date"><em>2023-02-09</em></h4>



<p>This document describes the usage of the main flowSim functions and reports examples of typical flowSim scripts.</p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>flowSim is a tool designed to visualize, detect and remove highly redundant information in large FCM training sets, increasing the performance of ML algorithms by reducing overfitting while at the same time decreasing computational time for training. The tool performs near duplicate image detection (NDD) by combining community detection algorithms with the density analysis of the marker expression values.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>The easiest way to install flowSim is directly from github:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;semontante/flowSim&quot;</span>)</code></pre></div>
<p>The user can also download the package locally and install it from the package folder:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install</span>(<span class="st">&quot;path/to/local_dir&quot;</span>)</code></pre></div>
</div>
<div id="input" class="section level2">
<h2>Input</h2>
<p>The input of flowSim is a directory containing the bivariate marker expression of the images under analysis. In particular, the marker expression of each image must be reported in a csv file whose first and second column report the expression of, respectively, the first and second marker. Here’s an example of a correctly formatted csv file:</p>
<pre><code>#&gt;   PE.CF594.A FITC.A
#&gt; 1      2.985  3.137
#&gt; 2      2.433  2.752
#&gt; 3      2.942  2.914
#&gt; 4      2.874  3.121
#&gt; 5      1.805  2.119
#&gt; 6      1.925  2.712
#&gt; 7      0.871  2.560
#&gt; 8      2.782  2.836
#&gt; 9      2.645  2.265</code></pre>
<p><strong>Note:</strong> If the input csv contains more than two columns, the other columns are ignored. For example, if the csv files contain a third column with events membership, this third column will be ignored.</p>
</div>
<div id="identification-and-removal-of-similar-images" class="section level2">
<h2>Identification and removal of similar images</h2>
<p>There are two main functions to consider in the flowSim package:</p>
<ol style="list-style-type: decimal">
<li>V1 mode: get_similarity_all_plots() for small datasets (&lt; 500 files).</li>
<li>V2 mode: get_similarity_all_plots_v2() for large datasets.</li>
</ol>
<p>Both functions calculate the pairwise distance matrix of all input files under analysis. They have similar arguments, see help(get_similarity_all_plots_v2) or help(get_similarity_all_plots) to look at the list of possible options.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># get the directory path where the csv files are stored</span>

fpath &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="dt">package=</span><span class="st">&quot;flowSim&quot;</span>)

<span class="co"># get similarity scores matrix for all files (V1 mode, &lt; 500 files)</span>
<span class="kw">library</span>(parallel)
<span class="kw">library</span>(sm)
<span class="kw">library</span>(utils)
out&lt;-<span class="kw">get_similarity_all_plots</span>(<span class="dt">path_dir =</span> fpath)

<span class="co"># alternatively, it is possible to feed the list of paths (only V1 mode)</span>
paths_plots&lt;-<span class="kw">list.files</span>(<span class="dt">path =</span> fpath,<span class="dt">full.names =</span> T)
out&lt;-<span class="kw">get_similarity_all_plots</span>(<span class="dt">paths_plots =</span> paths_plots)

<span class="co"># get similarity scores matrix for all files (V2 mode, &gt; 500 files)</span>
<span class="kw">library</span>(parallel)
<span class="kw">library</span>(sm)
<span class="kw">library</span>(doSNOW)
<span class="kw">library</span>(foreach)
<span class="kw">library</span>(Rtsne)
<span class="kw">library</span>(anocva)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(utils)
<span class="kw">library</span>(stats)
out&lt;-<span class="kw">get_similarity_all_plots_v2</span>(<span class="dt">path_dir =</span> fpath)

<span class="co"># In both modes the user can provide the indices of the paths of the files to analyze. It is possible to get these indices by using a dedicated flowSim function or by using the user's own code.</span>

inds_selected_files&lt;-<span class="kw">get_inds_files_selected</span>(<span class="dt">path_dir =</span> fpath, <span class="dt">files_selected =</span> files_new_cycle) 

<span class="co"># where files_new_cycle= vector of files names to analyze</span>
out&lt;-<span class="kw">get_similarity_all_plots_v2</span>(<span class="dt">n_samples=</span>inds_selected_files,<span class="dt">path_dir =</span> fpath) </code></pre></div>
<p>Based on this distance matrix, a network of nodes is generated (each node is a file under analysis). A community detection algorithm is applied to identify the clusters of similar files:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Execute igraph clustering</span>
<span class="kw">library</span>(igraph)
<span class="kw">library</span>(RColorBrewer)
list_output&lt;-<span class="kw">gen_igraph_network</span>(<span class="dt">similarity_output =</span> out,<span class="dt">method_clust =</span> <span class="st">&quot;louvain&quot;</span>) <span class="co"># louvain clustering</span>
igraph_network&lt;-list_output<span class="op">$</span>igraph_network
partition_vec&lt;-list_output<span class="op">$</span>partition
<span class="co"># generate visnetwork</span>
<span class="kw">library</span>(visNetwork)
<span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># set seed to get same groups colors</span>
visnetdata&lt;-<span class="kw">gen_visnetwork_data</span>(igraph_network)
<span class="co"># heterogeneity score (optional)</span>
<span class="kw">library</span>(igraph)
heterogeneity_score&lt;-<span class="kw">get_heterogeneity_score</span>(igraph_network,<span class="dt">partition_vec=</span>partition_vec,<span class="dt">visnetdata =</span> visnetdata)</code></pre></div>
<p>The user can optionally visualize the network:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot full network</span>
<span class="kw">library</span>(visNetwork)
<span class="kw">plot_visnet</span>(visnetdata)</code></pre></div>
<p>The final step is to filter out the similar files and export the final results (the selected files for each cluster). The user can select among 3 options, it is possible: 1. To get a dataframe reporting the names of the selected files for each group. 2. To export the bivariate plots of selected files for each group. 3. To export the bivariate plots of all files of all groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># (1) get a dataframe reporting the names of the selected files for each group.</span>
<span class="kw">library</span>(stats)
df_features&lt;-<span class="kw">import_df_features</span>(<span class="dt">paths_plots =</span> paths_plots) <span class="co"># or using directory: paths_dir=fpath</span>
info_exporting&lt;-<span class="kw">exports_filtered_plots</span>(<span class="dt">visnetdata =</span> visnetdata,<span class="dt">df_features =</span> df_features)

<span class="co"># (2) export the bivariate plots of selected files for each group.</span>
<span class="kw">library</span>(stats)
<span class="kw">library</span>(graphics)
df_features&lt;-<span class="kw">import_df_features</span>(<span class="dt">paths_plots =</span> paths_plots) <span class="co"># or using directory: paths_dir=fpath</span>
info_exporting&lt;-<span class="kw">exports_filtered_plots</span>(<span class="dt">visnetdata =</span> visnetdata,<span class="dt">df_features =</span> df_features, 
                                       <span class="dt">path_expr_data =</span> fpath,<span class="dt">path_output =</span> <span class="st">&quot;path/to/output_dir&quot;</span>)   

<span class="co"># Note: the output of V2 mode contains already the df_features</span>
out&lt;-<span class="kw">get_similarity_all_plots_v2</span>(<span class="dt">path_dir =</span> fpath) <span class="co"># Execution of V2 mode t the start of the script.</span>
info_exporting&lt;-<span class="kw">exports_filtered_plots</span>(<span class="dt">visnetdata =</span> visnetdata,<span class="dt">df_features =</span> out<span class="op">$</span>df_features)
  
<span class="co"># (3) export the bivariate plots of all files of all groups</span>
<span class="kw">library</span>(graphics)
<span class="kw">exports_plots</span>(<span class="dt">visnetdata =</span> visnetdata,<span class="dt">path_expr_data =</span> fpath, <span class="dt">path_output =</span> <span class="st">&quot;path/to/output_dir&quot;</span>)
              </code></pre></div>
<p>In the (2) and (3) the output directory will contain a folder for each detected group of files.</p>
</div>
<div id="visualization-options" class="section level2">
<h2>Visualization options</h2>
<p>There are 3 different type of network visualization. The user can visualize all the input files organized in custers and all the isolated files (“full network visualization”“):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(visNetwork)
<span class="co"># plot full network</span>
<span class="kw">plot_visnet</span>(visnetdata)
<span class="co"># plot full network setting the size of nodes</span>
<span class="kw">plot_visnet</span>(visnetdata,<span class="dt">size_nodes=</span><span class="dv">25</span>)</code></pre></div>
<p>The user can also visualize only a partial area of the network (“partial network visualization”). The isolated files (black nodes) can also be removed. This is particularly useful for large networks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot network without the isolated files</span>
<span class="kw">plot_visnet</span>(visnetdata,<span class="dt">remove_single_files =</span> T)
<span class="co"># plot only specific groups</span>
<span class="kw">plot_visnet</span>(visnetdata,<span class="dt">select_group =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>))</code></pre></div>
<p>Finally, for very large networks (&gt; 4000 files), it is not possible to plot the full network at once. It is useful in this case to plot a contracted version of the network, where each node is a group and each edge is proportional to the number of connections between the groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate contracted data</span>
visnetdata_contracted&lt;-<span class="kw">gen_visnetwork_data</span>(igraph_network,<span class="dt">contract_net =</span> T)
<span class="co"># plot contracted network</span>
<span class="kw">plot_visnet</span>(visnetdata_contracted) </code></pre></div>
</div>
<div id="small-vs-large-datasets-parameters-tuning" class="section level2">
<h2>small vs large datasets, parameters tuning</h2>
<p>The V1 algorithm is designed to work for small datasets (&lt; 500 files) and it is also the most accurate version.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get similarity scores matrix for all files (V1 mode, &lt; 500 files) with default parameters.</span>
<span class="kw">library</span>(parallel)
<span class="kw">library</span>(sm)
<span class="kw">library</span>(utils)
out&lt;-<span class="kw">get_similarity_all_plots</span>(<span class="dt">path_dir =</span> fpath)</code></pre></div>
<p>There are several parameters the user can set to personalize the similarity output. The tolerance parameter influences the number of clusters estimated by the algorithm. A lower tolerance threshold tends to generate a lower number of clusters (intra-cluster differences are more tolerated), while a higher tolerance threshold tends to generate more clusters (intra-cluster differences are less tolerated). The default tolerance threshold for the V1 mode is 0.6.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set tolerance to 0.7. Default is 0.6 </span>
out&lt;-<span class="kw">get_similarity_all_plots</span>(<span class="dt">path_dir =</span> fpath, <span class="dt">thr_score =</span> <span class="fl">0.7</span>)</code></pre></div>
<p>It is also possible to set the number of cores to use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use 4 cores.</span>
out&lt;-<span class="kw">get_similarity_all_plots</span>(<span class="dt">path_dir =</span> fpath, <span class="dt">n_cores=</span><span class="dv">4</span>) </code></pre></div>
<p>The V2 algorithm is designed to work with large datasets. It is faster, it consumes less memory, but it is also less accurate. It has the same parameters of V1 and an additional parameter to control the level of fragmentation of the dataset. As the fragmentation parameter increases, the time of execution and memory load decreases, but the accuracy also decreases. Up to 2000 files the fragmentation parameter is automatically estimated, above 2000 files it needs to be manually set. The default tolerance threshold for the V2 algorithm is 0.9.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># dataset broken in 5 fragments</span>
out&lt;-<span class="kw">get_similarity_all_plots_v2</span>(<span class="dt">path_dir =</span> fpath, <span class="dt">n_batches =</span> <span class="dv">5</span>)
<span class="co"># dataset broken in 100 fragments </span>
out&lt;-<span class="kw">get_similarity_all_plots_v2</span>(<span class="dt">path_dir =</span> fpath, <span class="dt">n_batches =</span> <span class="dv">100</span>)</code></pre></div>
<p>It is possible to increase the accuracy of the V2 algorithm, by performing several cycles of execution. Each cycle is performed on the files selected from the previous cycle. In this way, the residual homogeneity generated from the previous cycles is progressively reduced.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We execute flowSim in V2 mode.</span>
out&lt;-<span class="kw">get_similarity_all_plots_v2</span>(<span class="dt">path_dir =</span> fpath) 

list_output&lt;-<span class="kw">gen_igraph_network</span>(<span class="dt">similarity_output =</span> out,<span class="dt">method_clust =</span> <span class="st">&quot;louvain&quot;</span>)
igraph_network&lt;-list_output<span class="op">$</span>igraph_network
partition_vec&lt;-list_output<span class="op">$</span>partition
<span class="kw">set.seed</span>(<span class="dv">1234</span>) 
visnetdata&lt;-<span class="kw">gen_visnetwork_data</span>(igraph_network)
info_exporting&lt;-<span class="kw">exports_filtered_plots</span>(<span class="dt">visnetdata =</span> visnetdata,<span class="dt">df_features =</span> out<span class="op">$</span>df_features)

<span class="co"># The selected files will be the files of the next cycle</span>
files_new_cycle&lt;-<span class="kw">unlist</span>(<span class="kw">strsplit</span>(info_exporting<span class="op">$</span>files_filtered,<span class="st">&quot;;&quot;</span>))
inds_selected_files&lt;-<span class="kw">get_inds_files_selected</span>(<span class="dt">path_dir =</span> fpath, <span class="dt">files_selected =</span> files_new_cycle)

<span class="co"># We execute flowSim on the selected files of the previous cycles</span>
out&lt;-<span class="kw">get_similarity_all_plots_v2</span>(<span class="dt">n_samples=</span>inds_selected_files,<span class="dt">path_dir =</span> fpath) </code></pre></div>
<p>Both V1 mode and V2 mode have the same exporting step, which can be regulated by the filtering parameter. The filtering parameter controls how many files are selected from each group. The default value is 2.1. By decreasing this parameter, the number of files selected from each group increases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># default threshold: 2.1</span>
info_exporting&lt;-<span class="kw">exports_filtered_plots</span>(<span class="dt">visnetdata =</span> visnetdata,<span class="dt">df_features =</span> df_features)
<span class="co"># Filtering threshold set to 1.2. More patterns preserved.</span>
info_exporting&lt;-<span class="kw">exports_filtered_plots</span>(<span class="dt">visnetdata =</span> visnetdata,<span class="dt">df_features =</span> df_features,<span class="dt">filter_thr=</span><span class="fl">2.1</span>)</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
